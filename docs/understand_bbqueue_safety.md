# BBQueue の理解
どのようなコンセプトでどういう問題をクリアしたライブラリなのかを理解する。

## 概要
SPSCのロックフリー循環バッファ (+ no_std)


| 想定される問題種類 | BBQueueでの具体的な状況 | どう対応しているか |
|---|---|---|
| ポインタの競合 | read と write の位置などの情報が複数のスレッドから書き込まれてしまう | SPSC で共有しないから起きない |
| データの競合 | write 完了していない領域を read してしまう。read しきっていない領域に write してしまう | コア部分になる。別途書く。 |
| ABA問題 | read や write 位置などの情報変化を検知できない | それら変数を共有しないから起きない |
| デッドロック | read と write スレッドがお互いを待ちあう | SPSCかつロックフリーなので起きない |
| ライブロック | read と write スレッドがお互いを譲り合う | SPSCかつロックフリーなので起きない |
| スタベーション | read と write スレッドのいずれかが進行しない状態になる| SPSCかつロックフリーなので起きない |


### データ競合について
#### writeされていない領域を読まない
write済みな箇所を示す値はproducerのみがAtomicに操作する。
DMA等で、producer以外が書き込める領域は reserve で確保し、完了時にAtomicにcommitすることで安全にwrite位置を更新する。

#### readされていない領域に書かない
read済みな箇所を示す値はconsumerのみがAtomicに操作する。
